<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>IPTV Player V2</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
    body {
        margin: 0; font-family: Arial;
        background: var(--bg); color: var(--text);
        transition: 0.2s;
    }

    :root {
        --bg: #0d0d0d;
        --panel: #1a1a1a;
        --text: white;
        --hover: #333;
    }

    .light {
        --bg: #f2f2f2;
        --panel: #ffffff;
        --text: #111;
        --hover: #ddd;
    }

    header {
        padding: 15px; background: var(--panel);
        display: flex; justify-content: space-between;
        align-items: center; font-size: 20px;
        border-bottom: 1px solid #444;
    }

    #container { display: flex; height: 100vh; }

    #sidebar {
        width: 330px; background: var(--panel);
        overflow-y: auto; padding: 10px;
        border-right: 1px solid #444;
    }

    #player { flex-grow: 1; background: black; display: flex; align-items: center; }
    video { width: 100%; height: 100%; }

    input, select {
        width: 100%; padding: 10px; margin-bottom: 10px;
        border: none; border-radius: 5px;
    }

    .channel {
        padding: 10px; border-bottom: 1px solid #444;
        cursor: pointer; display: flex; align-items: center;
    }

    .channel:hover { background: var(--hover); }

    .logo {
        width: 45px; height: 45px; margin-right: 10px; border-radius: 6px;
        background: #222; object-fit: cover;
    }

    .fav-btn {
        margin-left: auto; font-size: 20px; cursor: pointer;
    }
</style>
</head>

<body>

<header>
    <div>üì∫ IPTV Player V2</div>
    <button id="themeBtn">üåô</button>
</header>

<div id="container">

    <div id="sidebar">

        <input type="text" id="search" placeholder="Search channel...">

        <select id="category">
            <option value="all">All Categories</option>
            <option value="news">News</option>
            <option value="sports">Sports</option>
            <option value="entertainment">Entertainment</option>
            <option value="kids">Kids</option>
            <option value="general">General</option>
        </select>

        <h3>Favorites ‚≠ê</h3>
        <div id="favorites"></div>

        <h3>Channels</h3>
        <div id="channels"></div>

    </div>

    <div id="player">
        <video id="video" controls autoplay></video>
    </div>

</div>

<script>
let channelData = [];
let favorites = JSON.parse(localStorage.getItem("iptvFav") || "[]");

async function loadIPTV() {
    const channels = await fetch("https://iptv-org.github.io/api/channels.json").then(r => r.json());
    const streams  = await fetch("https://iptv-org.github.io/api/streams.json").then(r => r.json());
    const cats     = await fetch("https://iptv-org.github.io/api/categories.json").then(r => r.json());

    channels.forEach(ch => {
        const stream = streams.find(s => s.channel === ch.id && s.status === "online");
        if (!stream) return;

        let category = "general";
        if (ch.categories && ch.categories.length > 0) category = ch.categories[0];

        channelData.push({
            id: ch.id,
            name: ch.name,
            logo: ch.logo,
            url: stream.url,
            category: category
        });
    });

    displayChannels(channelData);
    displayFavorites();
}

function displayChannels(listData) {
    const list = document.getElementById("channels");
    list.innerHTML = "";
    listData.forEach(c => {
        let div = document.createElement("div");
        div.className = "channel";
        div.innerHTML = `
            <img class="logo" src="${c.logo || ''}">
            <div>${c.name}</div>
            <div class="fav-btn" onclick="toggleFav('${c.id}', event)">‚≠ê</div>
        `;
        div.onclick = () => document.getElementById("video").src = c.url;
        list.appendChild(div);
    });
}

function displayFavorites() {
    const favList = document.getElementById("favorites");
    favList.innerHTML = "";

    let favData = channelData.filter(c => favorites.includes(c.id));
    favData.forEach(c => {
        let div = document.createElement("div");
        div.className = "channel";
        div.innerHTML = `
            <img class="logo" src="${c.logo}">
            <div>${c.name}</div>
            <div class="fav-btn" onclick="toggleFav('${c.id}', event)">‚ùå</div>
        `;
        div.onclick = () => document.getElementById("video").src = c.url;
        favList.appendChild(div);
    });
}

function toggleFav(id, e) {
    e.stopPropagation();
    if (favorites.includes(id)) favorites = favorites.filter(x => x !== id);
    else favorites.push(id);

    localStorage.setItem("iptvFav", JSON.stringify(favorites));
    displayFavorites();
}

document.getElementById("search").oninput = () => {
    const q = search.value.toLowerCase();
    const filtered = channelData.filter(c => c.name.toLowerCase().includes(q));
    displayChannels(filtered);
};

document.getElementById("category").onchange = () => {
    const cat = category.value.toLowerCase();
    if (cat === "all") { displayChannels(channelData); return; }
    const filtered = channelData.filter(c => c.category === cat);
    displayChannels(filtered);
};

document.getElementById("themeBtn").onclick = () => {
    document.body.classList.toggle("light");
};

loadIPTV();
</script>

</body>
</html>
